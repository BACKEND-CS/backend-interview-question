# 목차

1. [도메인 주소를 입력하면 일어나는 일](#도메인-주소를-입력하면-일어나는-일)
2. [TCP와 UDP의 특징](#tcp와-udp의-특징)
3. [TCP 3 way 와 4 way handshake](#tcp-3-way-와-4-way-handshake)
4. [HTTP 와 HTTPS 의 차이점](#http-와-https-의-차이점)
5. [Https SSL Handshake란](#https-ssl-handshake란)

## 도메인 주소를 입력하면 일어나는 일

<br>

입력한 도메인 주소로 웹사이트를 호스팅하는 서버의 IP 주소를 조회해야합니다.

IP주소를 조회하는 과정은 매우 빨라야 하기 때문에, 웹 브라우저는 도메인 주소 정보가 **①캐싱되어** 있는지 먼저 확인합니다.

캐싱된 기록이 없다면 ISP가 구축한 **②DNS**서버에 DNS 쿼리를 사용해서 해당 도메인 주소와 일치하는 IP주소를 전달받습니다.

찾은 IP주소에 **③TCP/IP 프로토콜**을 이용해 연결을 요청합니다. 신뢰할 수 있는 연결을 하기위해 TCP 3-way HandShake를 진행합니다.

연결이 된 후, 브라우저는 GET 요청으로 웹페이지를 요구합니다.

서버는 웹 브라우저에게 HTML파일로 응답하고 브라우저는 HTML을 랜더링하여 사용자에게 구글 화면을 보여줍니다.



### ① DNS 정보 캐싱

> CPU와 RAM 사이에 용량은 작지만 속도가 빠른 작은 메모리가 있는데, 이를 캐시라고 한다.
>
> 브라우저 캐시(DNS쿼리 사용) -> OS 캐시(systemcall 사용) -> 라우터 캐시 -> ISP 캐시 순으로 접근하려는 URL과 일치하는 정보가 저장되어 있는지 확인한다.
>
> DNS 서버에 요청하는 과정을 생략할 수 있게 된다.

<br>

### ② DNS

> 웹사이트의 도메인 주소와 IP주소를 알고 있는 서버이다.
>
> 브라우저가 DNS서버에 특정 도메인 주소를 전달하면, DNS 서버는 IP주소를 브라우저에게 알려준다.
>
> 브라우저는 전달받은 IP주소로 요청한다.

<br>

### ③TCP/IP 연결

> 1. 클라이언트는 요청 서버에 SYN 패킷을 보내 연결을 요청한다.
> 2. 요청을 수락한다면, 서버는 클라이언트에게 SYN 패킷과 ACK 패킷으로 응답한다.
> 3. 클라이언트는 ACK 패킷을 보내 연결 확립 응답을 보낸다.



<br>



## TCP와 UDP의 특징

<br>

TCP와 UDP는 전송계층에서 사용되는 프로토콜입니다.

포트 번호를 이용해 주소를 지정하고 데이터 오류검사를 위한 체크섬이 존재한다는 공통점이 있습니다.

<br>

TCP는 연결 지향적 프로토콜로서, 클라이언트와 서버가 연결된 상태에서 데이터를 주고받는 통신 방식입니다.(3-way handshake로 연결, 4-way handshake로 연결 해제)

고정된 네트워크 경로로 통신하기 때문에

데이터 처리 속도를 조절하여 수신자의 버퍼 오버플로우를 방지, 네트워크 내의 패킷 수가 과도하게 증가하지 않도록 조절할 수 있습니다.

신뢰성 향상을 위한 연결과정 때문에, UDP보다 속도는 느리고 1:1 통신만 가능하며, 패킷 순서 보장 때문에 중간에 패킷이 유실되면 재전송해야해서 통신 속도가 저하될 수 있습니다.



UDP는 비연결형 프로토콜입니다.

패킷의 전송 순서가 바뀔 수 있고 데이터 수신 여부를 확인하지 않아 신뢰성이 낮다. 하지만 속도가 빠르다는 이점이 있어 동영상 스트리밍 서비스와 같은 곳에 사용됩니다.

참고로, 헤더 설정을 추가하면 커스터마이징이 가능하기 때문에 신뢰성을 보장받도록 할 수 있습니다. HTTP/3가 UDP기반 통신을 적용한 이유중에 하나로 볼 수 있습니다.

> HTTP/3 (웹 상 정보 전달 프로토콜) 는 QUIC(Quick UDP Internet Connection)이라는 프로토콜 기반이다.

<br>

## TCP 3 way 와 4 way handshake

<img src="https://raw.githubusercontent.com/buinq/imageServer/main/img/image-20230222220547314.png" alt="image-20230222220547314" style="zoom:125%;" />

TCP는 연결 지향형 프로토콜이기 때문에, 송신측과 수신측이 연결되어야 합니다.

이를 위해서, TCP 헤더에 TCP 플래그가 있고, TCP 플래그에는 ACK · SYN · FIN 가 사용됩니다.

초기값은 0이고, 이 플래그로 3-way / 4-way handshake를 진행합니다.

1. 연결을 요청할 때, SYN 플래그로 요청을 보냅니다.

2. 연결을 받은 쪽은, 받은 SYN 플래그에 대한 응답으로 ACK 플래그와 연결 확립 요청을 위해 SYN 플래그를 보냅니다.

3. 연결을 처음에 요청했던 쪽은, 확립에 대한 응답으로 ACK 플래그를 보내는 것으로 3-way handshake는 마무리 됩니다.



연결을 종료하는 과정인 4-way handshake 에서는 FIN 플래그와 ACK 플래그를 사용합니다.

1. 연결 종료 요청을 FIN 플래그와 함께 보냅니다.
2. 종료 요청을 받은 쪽은 ACK 플래그로 응답합니다.
3. 요청 받은 쪽도 FIN 플래그로 연결 종료 확립 요청을 보냅니다.
4. 처음에 연결 종료 요청을 했던 쪽은, ACK 플래그로 연결 종료 확립 응답을 보내는 것으로 마무리 됩니다.

<br>

## HTTP 와 HTTPS 의 차이점



http는 애플리케이션 레벨의 프로토콜이고 기본적으로 80포트를 사용합니다. HTTP는 Method, Path, Version, Headers, Body로 구성됩니다.

암호화 되어있지 않는 평문 데이터를 전송하는 프로토콜이기 때문에, 보안상 취약점이 있었고 이를 해결하기 위해 HTTPS가 나타났습니다.

Https는 기본적으로 443포트를 사용하고 서버와 브라우저 사이에 TLS나 SSL(Secure Socket Layer) 프로토콜로 데이터를 암호화해 통신을 합니다.

<br>

## Https SSL Handshake란



SSL은 암호화 기법으로 대칭키 방식과 비대칭키 방식을 사용합니다.

<img src="https://raw.githubusercontent.com/buinq/imageServer/main/img/image-20230223222741693.png" alt="image-20230223222741693" height="400" />

대칭키 방식은 동일한 키로 암호화와 복호화를 수행하는 방법입니다.

같은 키를 가지고 있어 **대칭키**라 불리는 것입니다.

암호화 복호화 처리에서는 속도가 빠르다는 장점이 있지만, 누군가 키를 탈취해가면 보안상 취약해진다는 단점이 있습니다.

<img src="https://raw.githubusercontent.com/buinq/imageServer/main/img/image-20230223223048710.png" alt="image-20230223223048710" height="400" />

비대칭키 방식은 서로 다른 키로 복호화를 수행하는 방식입니다.

공개키로 암호화한 데이터는 개인키로만 복호화 할 수 있고, 개인키로 암호화한 데이터는 공개키로만 복호화할 수 있습니다.

따라서 누군가 공개키를 탈취해간다고 해도, 공개키로 암호화한 데이터를 복호화할 수 없습니다.

단, 비대칭키 방식은 대칭키 방식보다 보안상 유리하지만 암호화 연산 시간이 더 소요되어 비용이 크다는 단점이 있습니다.



SSL handshake 는 단점을 보안하기위해, 대칭키 방식과 비대칭키 방식을 혼합해서 사용합니다.

<img src="https://raw.githubusercontent.com/buinq/imageServer/main/img/image-20230223223914314.png" alt="image-20230223223914314" height="400" />

간략하게 설명하면, 서버는 자신이 검증된 서버라는 것을 증명하기 위해 CA(인증기관)에 심의를 받고 SSL인증서를 얻을 수 있습니다.

따라서, 사용자는 안전한 통신을 위해서 서버에게 SSL 인증서를 요구하고, 서버는 SSL 인증서를 전달합니다.

받은 SSL 인증서가 가짜일 수 있기 때문에, 사용자는 다시 CA에 검증을 받고 검증이 완료되면 서버의 개인키와 짝을 이루는 공개키를 전달합니다.



<img src="https://raw.githubusercontent.com/buinq/imageServer/main/img/image-20230223224135146.png" alt="image-20230223224135146" height="400" />

이제, 사용자는 공개키를, 서버는 개인키를 갖고 있기 때문에 데이터를 주고받으면 될 것 같지만 비대칭키 방식은 보안은 좋지만 그만큼 발생되는 비용이 있기 때문에 여기서 대칭키 방식을 접목합니다.

<img src="https://raw.githubusercontent.com/buinq/imageServer/main/img/image-20230223224355957.png" alt="image-20230223224355957" height="400" />



사용자는 그 공개키로 자신의 대칭키를 암호화 한뒤, 서버에 전송합니다.

해커가 대칭키를 가로챈다고해도, 공개키로 암호화된 대칭키를 복호화할 수 없습니다.

서버는 개인키로 공개키에 의해 암호화된 대칭키를 복호화 할 수 있습니다.

그렇게 양측이 대칭키를 갖고 있을 수 있게 되고, **대칭키 방식을 활용할 수 있게 됩니다.**





